# 🦝 너굴맵 (Neogulmap) 최종 프로젝트 보고서

## 1. 앱 주제 및 핵심 기능 설명

**주제:** 지도 기반 흡연구역 정보 제공 및 커뮤니티 애플리케이션

**너굴맵(Neogulmap)**은 사용자가 현재 위치 주변의 흡연구역을 손쉽게 찾을 수 있도록 돕는 안드로이드 애플리케이션입니다. 비흡연자에게는 피해야 할 구역을, 흡연자에게는 합법적인 흡연 공간을 제공하여 모두에게 유익한 환경을 조성하는 것을 목표로 합니다.

**핵심 기능:**
*   **지도 기반 탐색:** 카카오맵 API를 활용하여 주변 흡연구역을 시각적으로 제공.
*   **실시간 위치 추적:** 사용자의 현재 위치를 기반으로 가까운 흡연구역 자동 검색.
*   **상세 정보 제공:** 흡연구역의 사진, 주소, 상세 설명(실내/실외 등) 확인.
*   **길찾기 연동:** 카카오맵 앱과 연동하여 해당 흡연구역까지의 길찾기 기능 제공.
*   **소셜 로그인:** 카카오 계정을 이용한 간편 로그인 및 JWT 기반 보안 인증.
*   **신규 장소 제보:** 사용자가 직접 새로운 흡연구역을 제보하고 사진을 등록하는 기능.

---

## 2. 전체 화면 구성 요약

애플리케이션은 크게 다음과 같은 화면으로 구성되어 있습니다.

### 2.1 로그인 화면 (LoginScreen)
*   앱 실행 시 가장 먼저 나타나는 화면 (비로그인 시).
*   **기능:** 카카오 로그인 버튼을 통해 간편 로그인 진행.
*   *(스크린샷: 로그인 화면 이미지 삽입 필요)*

### 2.2 메인 홈 화면 (HomeScreen)
*   로그인 후 진입하는 메인 지도 화면.
*   **기능:** 전체 지도 표시, 내 위치 버튼, 하단 바텀시트를 통한 장소 상세 정보 표시, 메뉴 접근.
*   *(스크린샷: 지도에 마커가 표시된 홈 화면 이미지 삽입 필요)*

### 2.3 장소 등록 모달 (AddLocationModal)
*   사용자가 새로운 흡연구역을 등록하는 화면.
*   **기능:** 지도에서 위치 선택, 장소 이름/설명 입력, 사진 촬영/업로드.
*   *(스크린샷: 장소 등록 입력 폼 이미지 삽입 필요)*

### 2.4 마이페이지 (ProfileScreen)
*   사용자 정보 및 활동 내역 확인.
*   **기능:** 프로필 사진, 닉네임 표시, 로그아웃 기능.
*   *(스크린샷: 마이페이지 이미지 삽입 필요)*

---

## 3. 사용 기술 및 패키지

### 3.1 Android (Client)
*   **Language:** Kotlin
*   **UI Framework:** Jetpack Compose (Material Design 3)
*   **Architecture:** MVVM (Model-View-ViewModel) + Clean Architecture
*   **DI (Dependency Injection):** Hilt
*   **Network:** Retrofit2, OkHttp3
*   **Concurrency:** Coroutines, Flow
*   **Map:** KakaoMap Android SDK v2
*   **Login:** Kakao User SDK
*   **Local Storage:** Jetpack DataStore (Token Management)

### 3.2 Backend (Server)
*   **Framework:** Spring Boot 3.x (Java 17/Kotlin)
*   **Database:** H2 Database (In-Memory for Dev) / MySQL (Prod)
*   **Security:** Spring Security + JWT (JSON Web Token)
*   **Auth:** OAuth2 Client (Kakao)

---

## 4. 기능별 구현 상세 내용

### 4.1 카카오 로그인 및 JWT 인증
*   **구현:** 카카오 SDK를 통해 Access Token을 발급받고, 이를 백엔드 API (`/api/auth/login/kakao`)로 전송합니다.
*   **인증:** 백엔드는 토큰을 검증 후 자체 JWT Access Token을 발급하며, 앱은 이를 `DataStore`에 암호화하여 저장합니다.
*   **자동 인증:** `OkHttp Interceptor`를 구현하여 모든 API 요청 헤더에 자동으로 `Authorization: Bearer {Token}`을 추가합니다.

### 4.2 지도 및 마커 표시
*   **구현:** `KakaoMap SDK v2`를 Compose의 `AndroidView`로 래핑하여 사용했습니다.
*   **최적화:** 지도 줌 레벨을 강제로 변경하지 않고 `CameraUpdateFactory.newCenterPosition`을 사용하여 사용자 경험을 해치지 않으면서 위치를 이동하도록 구현했습니다.

### 4.3 위치 기반 서비스
*   **구현:** `FusedLocationProviderClient`를 사용하여 사용자의 정확한 위도/경도를 실시간으로 추적합니다.
*   **권한:** `ACCESS_FINE_LOCATION` 권한을 런타임에 요청하고 거부 시 적절한 안내를 제공합니다.

### 4.4 백엔드 연동 (Rest API)
*   **구현:** `Retrofit2` 인터페이스를 정의하고 `Repository` 패턴을 통해 데이터 레이어를 분리했습니다.
*   **DTO 매핑:** 서버의 요청/응답 스펙(DTO)에 맞춰 클라이언트 데이터 모델을 철저히 분리하여 관리했습니다.

---

## 5. 역할 분담 및 팀원별 기여도

**이 프로젝트는 1인 개발 프로젝트로 진행되었습니다.**

*   **이름:** 김가영
*   **기여도:** 100%
*   **담당 역할:**
    *   **기획:** 앱 아이디어 도출, UI/UX 설계.
    *   **Android 개발:** Jetpack Compose UI 구현, 카카오맵 연동, 비즈니스 로직 작성.
    *   **Backend 개발:** Spring Boot 서버 구축, API 설계 및 구현, JWT 인증 시스템 개발.
    *   **데이터 구축:** 공공데이터 포털의 흡연구역 데이터 전처리 및 DB 적재 스크립트 작성.

---

## 6. 구현 중 문제와 해결 전략

### 6.1 문제: 안드로이드 에뮬레이터 GPS 미수신
*   **현상:** 에뮬레이터에서 '내 위치' 버튼 클릭 시 반응이 없거나 구글 본사 위치로 이동함.
*   **원인:** 에뮬레이터는 하드웨어 GPS 센서가 없어서 실제 위치를 잡지 못함.
*   **해결:** 에뮬레이터의 **Extended Controls > Location** 메뉴에서 위도/경도(서울)를 수동으로 설정하고 `Mock Location` 테스트를 진행하여 해결했습니다. README에도 해당 가이드를 추가했습니다.

### 6.2 문제: 카카오 로그인 콜백 미수신
*   **현상:** 카카오톡 로그인 후 "동의하고 계속하기"를 눌러도 앱으로 돌아오지 않고 멈춤.
*   **원인:** `AndroidManifest.xml`에 카카오 SDK의 `AuthCodeHandlerActivity`가 등록되지 않아 인텐트 콜백을 받지 못함.
*   **해결:** 매니페스트에 올바른 스킴(`kakao${NATIVE_APP_KEY}`)을 가진 액티비티를 등록하여 해결했습니다.

### 6.3 문제: 서버 API 필드 불일치 (400/500 에러)
*   **현상:** 장소 등록 시 `Unrecognized field "id"` 또는 `name` 관련 파싱 에러 발생.
*   **원인:** 클라이언트 `ZoneDto`를 그대로 서버로 전송했으나, 서버 `ZoneRequest` DTO에는 `id` 필드가 없고 `name` 대신 `description`을 사용함.
*   **해결:** `ZoneRepositoryImpl`에서 전송 전용 `Map` 객체를 생성하여 서버 스펙에 정확히 맞는 JSON을 수동으로 구성하여 전송하도록 수정했습니다.

---

## 7. 회고 및 개선 아이디어

이번 프로젝트를 통해 안드로이드 클라이언트부터 백엔드 서버까지 풀스택 개발 과정을 경험할 수 있었습니다. 특히 OAuth2 인증 흐름과 지도 SDK의 깊이 있는 활용법을 익힌 것이 큰 수확입니다.

**향후 개선 아이디어:**
1.  **클러스터링 (Clustering):** 지도의 줌 레벨이 낮을 때 마커가 겹치는 현상을 방지하기 위해 마커 클러스터링 기능 도입.
2.  **커뮤니티 기능:** 단순 장소 제보를 넘어 사용자 리뷰 및 별점 기능을 추가하여 데이터 신뢰도 확보.
3.  **오프라인 모드:** `Room` DB 캐싱을 강화하여 네트워크가 없는 환경에서도 최근 조회한 지도를 볼 수 있도록 개선.

---
*작성일: 2025년 12월 20일*
